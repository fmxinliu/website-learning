<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>å¯è¿­ä»£å¯¹è±¡</title>
	<!-- https://zh.javascript.info/iterable#symboliterator -->
	<!-- å¯ä»¥åº”ç”¨ for..of çš„å¯¹è±¡è¢«ç§°ä¸ºå¯è¿­ä»£å¯¹è±¡ -->
	<!-- æœ‰ç´¢å¼•å’Œ length çš„å¯¹è±¡è¢«ç§°ä¸ºç±»æ•°ç»„å¯¹è±¡ -->
</head>
<body>
	<script>
		function print(msg) {
			document.write(msg);
			document.write("<br />");
		}

		
		/* ------------------- å¯è¿­ä»£å¯¹è±¡ ------------------------*/
		let range = {
			from: 1,
			to: 5
		};

		// æˆ‘ä»¬å¸Œæœ› for..of è¿™æ ·è¿è¡Œï¼š
		// for(let num of range) ... num=1,2,3,4,5

		// 1. ä½¿ç”¨ for..of å°†ä¼šé¦–å…ˆè°ƒç”¨å®ƒï¼š
		range[Symbol.iterator] = function() {

			 // 2. ...å®ƒè¿”å›ä¸€ä¸ªè¿­ä»£å™¨ï¼š
			 return {
    			current: this.from,
    			last: this.to,

			 	// 3. next() å°†åœ¨ for..of çš„æ¯ä¸€è½®å¾ªç¯è¿­ä»£ä¸­è¢«è°ƒç”¨
			 	next() {
			 		// 4. å®ƒå°†ä¼šè¿”å› {done:.., value :...} æ ¼å¼çš„å¯¹è±¡
			 		if (this.current <= this.last) {
			 			return { done: false, value: this.current++ };
			 		} else {
			 			return { done: true };
			 		}
			 	}
			 };
		};

		// ç°åœ¨å®ƒå¯ä»¥è¿è¡Œäº†ï¼
		for (let num of range) {
			print(num); // 1, ç„¶å 2, 3, 4, 5
		}


		/* ------------------- å¯è¿­ä»£å­—ç¬¦ä¸² ------------------------*/
		for (let char of "test") {
  			print( char ); // tï¼Œç„¶å eï¼Œç„¶å sï¼Œç„¶å t
		}

		/* ------------------- æ˜¾å¼è°ƒç”¨è¿­ä»£å™¨ ------------------------*/
		let str = "Hello";

		// å’Œä¸‹é¢ä»£ç å®Œæˆçš„åŠŸèƒ½ä¸€è‡´
		// for (let char of str) print(char);

		let iterator = str[Symbol.iterator](); // è·å–è¿­ä»£å™¨å¯¹è±¡

		while (true) {
			let result = iterator.next();
			if (result.done) break;
			print(result.value); // ä¸€ä¸ªä¸€ä¸ªè¾“å‡ºå­—ç¬¦
		}

		/* ------------------- â€œå¯è¿­ä»£å¯¹è±¡â€ ä¸ â€œç±»æ•°ç»„å¯¹è±¡â€ ------------------------*/
		// (1) å¯è¿­ä»£å¯¹è±¡ --- for..of
		// (2) ç±»æ•°ç»„å¯¹è±¡ --- æœ‰ç´¢å¼•å’Œlengthã€‚è¿™ç§å¯¹è±¡ä¹Ÿè®¸ä¹Ÿæœ‰å…¶ä»–å±æ€§å’Œæ–¹æ³•ï¼Œä½†æ˜¯æ²¡æœ‰æ•°ç»„çš„å†…å»ºæ–¹æ³•ã€‚
		let arrayLike = { // æœ‰ç´¢å¼•å’Œé•¿åº¦ => ç±»æ•°ç»„å¯¹è±¡
			0: "Hello",
			1: "World",
			length: 2,

			from: 0,
			to: 1,

			[Symbol.iterator]() {
				this.current = this.from;
				return this; // ===============æ—¢æ˜¯ â€œè¿­ä»£å™¨å¯¹è±¡â€ ä¹Ÿæ˜¯ â€œè¿­ä»£å¯¹è±¡â€
			},

			next() {
				if (this.current <= this.to) {
					return { done: false, value: this[this.current++]};
				} else {
					return { done: true };
				}
			}
		};

		print(`${arrayLike[0]} ${arrayLike[1]}`);

		for (let item of arrayLike) {
			print(item);
		}

		debugger;

		/* ------------------- Array.from ------------------------*/
		// è¯­æ³•ï¼šArray.from(obj[, mapFn, thisArg]) ä»¥ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡æˆ–è€…ç±»æ•°ç»„å¯¹è±¡ä½œä¸ºå‚æ•°å¹¶è¿”å›ä¸€ä¸ªçœŸæ­£çš„ Array æ•°ç»„
		let arr = Array.from(arrayLike);
		print( arr.pop() ); // æ•°ç»„æ–¹æ³• pop

		arr = Array.from(range, num => num * num);
		print( arr );


		debugger;
		//////////////////////////
		str = "hello world";
		print(Array.from( str ));

		function f1(str) {
			let chars = []; // Array.from å†…éƒ¨å®Œæˆäº†åŒæ ·çš„å¾ªç¯
			for (let char of str) {
				chars.push(char);
			}

			return chars;
		}

		print( f1(str) );

		////////////////////////
		function slice(str, start, end) {
			return Array.from(str).slice(start, end).join(''); // åˆ›å»ºèƒ½å¤„ç† UTF-16 æ‰©å±•å­—ç¬¦çš„ slice æ–¹æ³•
		}

		str = 'ğ’³ğŸ˜‚ğ©·¶';

		print( slice(str, 1, 3) ); // ğŸ˜‚ğ©·¶

		// åŸç”Ÿæ–¹æ³•ä¸æ”¯æŒè¯†åˆ« UTF-16 æ‰©å±•å­—ç¬¦
		print( str.slice(1, 3) ); // ä¹±ç ï¼ˆä¸¤ä¸ªä¸åŒ UTF-16 æ‰©å±•å­—ç¬¦ç¢ç‰‡æ‹¼æ¥çš„ç»“æœï¼‰

		for (let char of str) {
			print(char); // å­—ç¬¦ä¸²è¿­ä»£å™¨èƒ½å¤Ÿè¯†åˆ« UTF-16 æ‰©å±•å­—ç¬¦
		}
	</script>
</body>
</html>